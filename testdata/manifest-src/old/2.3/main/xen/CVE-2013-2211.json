{
  "IssueID": 2121,
  "VulnerabilityID": "CVE-2013-2211",
  "Release": "2.3",
  "Package": "xen",
  "Repository": "main",
  "FixedVersion": "4.1.4-r5",
  "Subject": "[v2.3] Xen Security Advisory 57 - libxl allows guest write access to sensitive console related xenstore keys (CVE-2013-2211 )",
  "Description": "ISSUE DESCRIPTION\r\n=================\r\n\r\nThe libxenlight (libxl) toolstack library does not correctly set\r\npermissions on xenstore keys relating to paravirtualised and emulated\r\nserial console devices. This could allow a malicious guest\r\nadministrator to change values in xenstore which the host later relies\r\non being implicitly trusted.\r\n\r\nIMPACT\r\n======\r\n\r\nA malicious guest administrator can read and write any files in the\r\nhost filesystem which are accessible to the user id running the\r\nxenconsole client binary. This may be the user id of a host\r\nadministrator who connects to the guest's console or the user id of\r\nany self service mechanism provided to guest administrators by the\r\nhost provider.\r\n\r\nAs well as reading and writing files an attacker with access to an HVM\r\nguest can cause any PV or serial consoles to be connected to a variety\r\nof network resources (sockets, udp connections) or other end points\r\n(fifo, pipes) in the host file filesystem according to the privileges\r\ngranted to the qemu device model for that guest.\r\n\r\nA malicious guest administrator can also redirect the VNC console\r\nport of the guest to another port on the host. This may expose the VNC\r\nport of other guests or of other firewalled services to an attack.\r\n\r\nVULNERABLE SYSTEMS\r\n==================\r\n\r\nAll systems which use libxl as part of the toolstack are vulnerable.\r\n\r\nlibxl is present in Xen versions 4.0 onwards.\r\n\r\nThe major consumer of libxl functionality is the xl toolstack which\r\nbecame the default in Xen 4.2.\r\n\r\nIn addition to this libvirt can optionally make use of libxl. This can\r\nbe queried with\r\n        # virsh version\r\n\r\nWhich will report \"xenlight\" if libxl is in use. libvirt currently\r\nprefers the xend backend if xend is running.\r\n\r\nThe xend and xapi toolstacks do not currently use libxl.\r\n\r\nMITIGATION\r\n==========\r\n\r\nHost administrators can start a domain paused and manually correct the\r\nxenstore permissions of the relevant nodes.\r\n\r\nA domain can be started in the paused state with xl by using\r\n    # xl create -p \u003ccfg\u003e\r\n\r\nA domain's domid can then be determined with:\r\n    # xl domid \u003cname\u003e\r\n\r\nIf using libvirt then virsh can be used instead:\r\n    # virsh start --paused \u003cname\u003e\r\n    # virsh domid \u003cname\u003e\r\n\r\nFor a domain $DOMID the following command will recursively correct the\r\npermissions for the primary PV console:\r\n\r\n    # xenstore-chmod -r /local/domain/$DOMID/console n0 r$DOMID\r\n\r\nIf the domain uses a device model stubdomain then it will also be\r\nnecessary to fix the permissions for the stubdomain. The stubdomain is\r\nnamed \"\u003cname\u003e-dm\". Assuming its domain ID is $DMDOM:\r\n\r\n    # xenstore-chmod -r /local/domain/$DMDOM/console n0 r$DMDOM\r\n\r\nIn addition a stub domain has three secondary PV consoles which must be\r\nfixed, however in this case the \"state\" and \"protocol\" nodes along\r\nwith the device node itself should not be restricted. For each device\r\n$D in [1,2,3]:\r\n\r\n    # xenstore-chmod -r /local/domain/$DMDOM/device/console/$N n0 r$DMDOM\r\n    # xenstore-chmod /local/domain/$DMDOM/device/console/$N/state n$DMDOM r0\r\n    # xenstore-chmod /local/domain/$DMDOM/device/console/$N/protocol n$DMDOM r0\r\n    # xenstore-chmod /local/domain/$DMDOM/device/console/$N n$DMDOM r0\r\n\r\nThe current permissions can be listed with\r\n    # xenstore-ls -fp \u003cPATH\u003e\r\n\r\nOnce the permissions are fixed you may unpause the domain with\r\n    # xl unpause \u003cdomain\u003e\r\nor with virsh:\r\n    # virsh resume \u003cdomain\u003e\r\n\r\nThe permissions can also be corrected on a live system if they are\r\nthen manually validated to be non-malicious.\r\n\r\nSee http://wiki.xen.org/wiki/XenBus#Permissions for information on the\r\npermissions syntax.\r\n\r\nRESOLUTION\r\n==========\r\n\r\nApplying the appropriate attached patch resolves this issue.\r\n\r\nxsa57-4.2.patch             Xen 4.2.x\r\nxsa57-4.1.patch             Xen 4.1.x\r\nxsa57-unstable.patch        xen-unstable\r\n\r\n$ sha256sum xsa57-*.patch\r\n428a1d42f4314404cde339a78a59422bf4f0590c4d16ea8adc83425fe5eede3d  xsa57-4.1.patch\r\nb6a5106848541972519cc529859d9ff3083c79367276c7031560fa4ce6f9f770  xsa57-4.2.patch\r\nd329f56c30f7a4f91906658ea661234d2ca31b74ee68257bf009072999b3d3ef  xsa57-unstable.patch"
}